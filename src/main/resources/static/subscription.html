<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>My Subscription Status</title>

  <!-- Font‑Awesome Icons -->
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

  <style>
    *{margin:0;padding:0;box-sizing:border-box;font-family:"Segoe UI",sans-serif;}

    /* ---------- NAVBAR ---------- */
    .navbar{display:flex;justify-content:space-between;align-items:center;
            background:#2f4f4f;padding:10px 30px}
    .navbar .brand{color:#fff;font-size:20px;font-weight:bold;text-decoration:none}
    .nav-links{display:flex;gap:20px}
    .nav-links a{color:#fff;text-decoration:none;font-size:14px;display:flex;
                 align-items:center;gap:6px;transition:opacity .3s}
    .nav-links a:hover{opacity:.7}
    .nav-links a.active{color:#03a9f4}
    .nav-links a.active i{color:#03a9f4}

    /* ---------- PAGE BODY ---------- */
    body{
      background:#f4f7fc;
      display:flex;
      flex-direction:column;
      min-height:100vh;
    }
    main{flex:1;display:flex;align-items:center;justify-content:center;}

    .card{
      background:#fff;
      padding:40px 60px;
      text-align:center;
      border-radius:12px;
      box-shadow:0 10px 25px rgba(0,0,0,.05);
      max-width:400px;
      width:100%;
    }
    h1{font-size:26px;color:#2c3e50;margin-bottom:10px;}
    p{font-size:16px;color:#555;margin-bottom:30px;}

    .status{
      font-size:18px;font-weight:600;padding:12px 18px;border-radius:6px;
      display:inline-block}
    .active  {background:#e8f8f0;color:#27ae60;}
    .inactive{background:#fdecea;color:#e74c3c;}

    .btn-refresh{
      margin-top:25px;padding:10px 18px;background:#2c3e50;color:#fff;border:none;
      border-radius:6px;cursor:pointer;transition:background .3s}
    .btn-refresh:hover{background:#34495e;}
  </style>
</head>
<body>

  <!-- ---------- NAVBAR ---------- -->
  <div class="navbar">
    <a href="user-home.html" class="brand">HealthMate</a>
    <div class="nav-links">
      <a href="user-profile.html"><i class="fas fa-user"></i> Profile</a>
      <a href="payment.html" class="active"><i class="fas fa-credit-card"></i> Subscription</a>
      <a href="reportpage.html"><i class="fas fa-chart-line"></i> Reports</a>
      <a href="contactdoctor.html"><i class="fas fa-bell"></i> Notification</a>
      <a href="signin.html" onclick="alert('Logged out successfully!')">
        <i class="fas fa-sign-out-alt"></i> Logout
      </a>
    </div>
  </div>

  <!-- ---------- MAIN CARD ---------- -->
  <main>
    <div class="card">
      <h1>Subscription Status</h1>
      <p id="msg">Checking your subscription…</p>
      <button class="btn-refresh" onclick="checkSubscription()">
        <i class="fa fa-sync-alt"></i> Refresh
      </button>
    </div>
  </main>

  <!-- ---------- SCRIPT ---------- -->
  <script>
    const msg = document.getElementById("msg");

    function setStatus(text, isActive){
      msg.textContent = text;
      msg.className = "status " + (isActive ? "active" : "inactive");
    }

    function checkSubscription(){
      msg.textContent = "Checking your subscription…";
      msg.className = "";

      fetch("http://localhost:7469/api/payment/check_subscription", {credentials:"include"})
        .then(res => res.text().then(t => ({ ok: res.ok, text: t })))
        .then(({ ok, text }) => {
          if(ok){
            setStatus(text, true);
          }else if(text.toLowerCase().includes("no active")){
            setStatus(text, false);
          }else{
            throw new Error(text);
          }
        })
        .catch(err=>{
          console.error(err);
          setStatus("⚠️ "+err.message, false);
        });
    }

    // initial check on load
    checkSubscription();
  </script>

</body>
</html>
